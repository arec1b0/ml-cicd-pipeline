replicaCount: 2

image:
  repository: your-registry/ml-cicd-pipeline-api
  tag: "latest"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 8000

canary:
  enabled: true
  image:
    tag: "canary"
  replicaCount: 1
  weight: 10  # percentage routed to canary via ingress annotation

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi
nodeSelector: {}
tolerations: []
affinity: {}

# Persistence configuration for shared model cache
persistence:
  enabled: false  # Set to true to use shared PVC instead of emptyDir
  accessMode: ReadWriteMany  # Required for multi-pod access
  size: 10Gi
  storageClass: ""  # Leave empty to use default storage class

# HorizontalPodAutoscaler configuration
hpa:
  enabled: true
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 75
  canaryMinReplicas: 1

# PodDisruptionBudget configuration
pdb:
  enabled: true
  # minAvailable can be a number (e.g., 1) or percentage (e.g., "50%")
  minAvailable: 1
  canaryMinAvailable: 1

# NetworkPolicy configuration
networkPolicy:
  enabled: true
  ingressController:
    namespace: ingress-nginx
    namespaceLabels: {}
    podLabels:
      app.kubernetes.io/name: ingress-nginx
  prometheus:
    enabled: true
    namespace: monitoring
    namespaceLabels: {}
    podLabels:
      app: prometheus
  egress:
    mlflow:
      enabled: true
      namespace: default
      namespaceLabels: {}
      podLabels:
        app: mlflow
      port: 5000
    loki:
      enabled: true
      namespace: monitoring
      namespaceLabels: {}
      podLabels:
        app: loki
      port: 3100
    jaeger:
      enabled: true
      namespace: monitoring
      namespaceLabels: {}
      podLabels:
        app: jaeger
      port: 14268

env:
  logLevel: INFO
  logFormat: json
  modelSource: mlflow
  modelPath: ""  # leave blank to use runtime downloads
  modelCacheDir: /var/cache/ml-model
  modelAutoRefreshSeconds: 300
  expectedFeatureDimension: ""  # Optional override for model input dimension (default: 4 for Iris, auto-derived from model at startup)
  mlflow:
    modelName: iris-random-forest
    modelStage: Production
    modelVersion: ""  # optional explicit version override
    trackingUri: ""   # e.g., http://mlflow:5000
    trackingUsername: ""
    trackingPasswordSecretName: ""  # REQUIRED: Reference to a Kubernetes Secret providing MLFLOW_TRACKING_PASSWORD
    trackingPasswordSecretKey: password  # Key within the secret
  adminTokenHeader: X-Admin-Token
  adminTokenSecretName: ""   # REQUIRED: Reference to a Kubernetes Secret providing ADMIN_API_TOKEN
  adminTokenSecretKey: token  # Key within the secret
  # Note: Secrets must be created externally using External Secrets Operator, Sealed Secrets, or kubectl
  # See SECRET_MANAGEMENT.md for detailed instructions
  otelExporterOtlpEndpoint: ""  # Set to e.g., http://tempo:4317 for tracing
  otelServiceName: ml-cicd-pipeline
  otelResourceAttributes: "deployment.environment=production"

# ServiceAccount configuration
serviceAccount:
  # Specifies whether a ServiceAccount should be created
  create: true
  # Annotations to add to the ServiceAccount
  annotations: {}
  # The name of the ServiceAccount to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# RBAC configuration
rbac:
  # Specifies whether RBAC resources should be created
  create: true
  # Additional rules to add to the Role (beyond the default minimal permissions)
  rules: []

# External Secrets Operator configuration
externalSecrets:
  # Enable External Secrets Operator integration
  enabled: false
  # Reference to ExternalSecretStore (e.g., "aws-secrets-manager" or "vault-backend")
  storeRef: ""
  # Admin token secret configuration
  adminToken:
    # Secret name in external store
    secretName: ""
    # Key in external secret
    secretKey: "token"
    # Refresh interval (e.g., "1h", "30m")
    refreshInterval: "1h"
  # MLflow credentials secret configuration
  mlflowCredentials:
    # Secret name in external store
    secretName: ""
    # Key in external secret
    secretKey: "password"
    # Refresh interval (e.g., "1h", "30m")
    refreshInterval: "1h"
